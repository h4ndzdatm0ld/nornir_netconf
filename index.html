<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="None">
  
  <link rel="canonical" href="https://h4ndzdatm0ld.github.io/nornir_netconf/">
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>Nornir NETCONF Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="assets/_mkdocstrings.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Home";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = "/nornir_netconf/";
  </script>
  
  <script src="js/jquery-2.1.1.min.js" defer></script>
  <script src="js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> Nornir NETCONF Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href=".">Home</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#plugins">Plugins</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#connections">Connections</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#tasks">Tasks</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#response-result">Response Result</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#global-lock">Global Lock</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#additional-documentation">Additional Documentation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#contributions">Contributions</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#testing">Testing</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#integration-tests">Integration Tests</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sysrepo-netopeer2">Sysrepo: netopeer2</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">Nornir NETCONF Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Home</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/h4ndzdatm0ld/nornir_netconf/edit/master/docs/index.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="nornir-netconf">Nornir NETCONF</h1>
<p><a href="https://codecov.io/gh/h4ndzdatm0ld/nornir_netconf"><img alt="codecov" src="https://codecov.io/gh/h4ndzdatm0ld/nornir_netconf/branch/develop/graph/badge.svg?token=MRI39YHOOR" /></a>
<a href="https://github.com/nornir-automation/nornir_netconf/actions?query=workflow%3Atest_nornir_netconf"><img alt="Build Status" src="https://github.com/nornir-automation/nornir_netconf/workflows/test_nornir_netconf/badge.svg" /></a></p>
<p>Collection of NETCONF tasks and connection plugin for <a href="https://github.com/nornir-automation/nornir">Nornir</a></p>
<h2 id="installation">Installation</h2>
<hr />
<pre><code class="language-bash">pip install nornir_netconf
</code></pre>
<h2 id="plugins">Plugins</h2>
<hr />
<h3 id="connections">Connections</h3>
<hr />
<ul>
<li><strong>netconf</strong> - Connect to network devices using <a href="https://github.com/ncclient/ncclient">ncclient</a></li>
</ul>
<h3 id="tasks">Tasks</h3>
<hr />
<ul>
<li><strong>netconf_capabilities</strong> - Return server capabilities from target</li>
<li><strong>netconf_get</strong> - Returns state data based on the supplied xpath</li>
<li><strong>netconf_get_config</strong> - Returns configuration from specified configuration store (default="running")</li>
<li><strong>netconf_edit_config</strong> - Edits configuration on specified datastore (default="running")</li>
<li><strong>netconf_lock</strong> - Locks or Unlocks a specified datastore (default="lock")</li>
<li><strong>netconf_commit</strong> - Commits a change</li>
</ul>
<h2 id="response-result">Response Result</h2>
<p>The goal of the task results is to put the NETCONF RPC-reply back in your hands. An 'rpc' key will be available which can then be used to access 'data_xml' or 'xml' depending on the type of response or any other attributes available, such as 'error', 'errors'. Some of the RPC is unpacked and provided back as part of the Result by default, including the 'error', 'errors' and 'ok' if available. Anything else can be accessed directly from the rpc.</p>
<p>Furthermore, some tasks allow the 'xml_dict' boolean argument. This will take the response RPC XML and convert it into a python dictionary. Keep in mind, this may not be perfect as XML does't quite translate 100% into a python dictionary.</p>
<p>For example, an xml response can include a collapsed response with open/close as so:  <code>&lt;ok/&gt;</code>
If parsed into python dictionary using xml_dict argument, the key of 'ok' will have a value of none.  However, if we were to be parsing <code>&lt;enabled&gt;True&lt;/enabled&gt;</code> this would show a key of 'enabled' and a value of 'True'.</p>
<p>This is a simple built-in solution available, but not the only one. You have the RPC as part of the response and you are able to parse it anyway or method which works better for you.</p>
<h2 id="global-lock">Global Lock</h2>
<p>The <code>netconf_lock</code> task will always return the Manager object, which is the established (and locked) agent used to send RPC's back and forth. The idea of retrieving the Manager is to carry this established locked session from task to task and only lock and unlock once during a run of tasks.  Please review the examples below to see how to extract the manager and store it under the <code>task.host</code> dictionary as a variable which can be used across multiple tasks. The Manager is passed into other tasks and re-used to send RPCs to the remote server.</p>
<h3 id="examples">Examples</h3>
<p>Head over to the <a href="https://github.com/h4ndzdatm0ld/nornir_netconf/tree/develop/examples">Examples directory</a> if you'd like to review the files.</p>
<details><summary>Directory Structure</summary>


<pre><code class="language-bash">├── example-project
│   ├── config.yml
│   ├── inventory
│   │   ├── groups.yml
│   │   ├── hosts-local.yml
│   │   └── ssh_config
│   ├── logs
│   │   └── nornir.log
│   └── nr-get-config.py
└── README.md
</code></pre>


</details>

<details><summary>Netconf Connection Plugin</summary>

Below is the snippet of a host inside the host-local.yml file and it's associated group, 'sros'.


<pre><code class="language-yaml">nokia_rtr:
  hostname: &quot;192.168.1.205&quot;
  port: 830
  groups:
    - &quot;sros&quot;
</code></pre>



<pre><code class="language-yaml">sros:
  username: &quot;netconf&quot;
  password: &quot;NCadmin123&quot;
  port: 830
  platform: &quot;sros&quot;
  connection_options:
    netconf:
      extras:
        hostkey_verify: false
        timeout: 300
        allow_agent: false
        look_for_keys: false
</code></pre>


</details>

<details><summary>Task: Get Config</summary>


<pre><code class="language-python">&quot;&quot;&quot;Nornir NETCONF Example Task: 'get-config'.&quot;&quot;&quot;
from nornir import InitNornir
from nornir_utils.plugins.functions import print_result
from nornir_netconf.plugins.tasks import netconf_get_config


__author__ = &quot;Hugo Tinoco&quot;
__email__ = &quot;hugotinoco@icloud.com&quot;

nr = InitNornir(&quot;config.yml&quot;)

# Filter the hosts by 'west-region' assignment
west_region = nr.filter(region=&quot;west-region&quot;)


def example_netconf_get_config(task):
    &quot;&quot;&quot;Test get config.&quot;&quot;&quot;

    task.run(
        netconf_get_config,
        source=&quot;running&quot;,
        path=&quot;&quot;&quot;
        &lt;configure xmlns=&quot;urn:nokia.com:sros:ns:yang:sr:conf&quot;&gt;
            &lt;router&gt;
                &lt;router-name&gt;Base&lt;/router-name&gt;
            &lt;/router&gt;
        &lt;/configure&gt;
        &quot;&quot;&quot;,
        filter_type=&quot;subtree&quot;,
    )


def main():
    &quot;&quot;&quot;Execute Nornir Script.&quot;&quot;&quot;
    print_result(west_region.run(task=example_netconf_get_config))


if __name__ == &quot;__main__&quot;:
    main()

</code></pre>


</details>

<details><summary>Task: Get Capabilities</summary>


<pre><code class="language-python">&quot;&quot;&quot;Nornir NETCONF Example Task: 'get-config'.&quot;&quot;&quot;
from nornir import InitNornir
from nornir_utils.plugins.functions import print_result
from nornir_netconf.plugins.tasks import netconf_capabilities


__author__ = &quot;Hugo Tinoco&quot;
__email__ = &quot;hugotinoco@icloud.com&quot;

nr = InitNornir(&quot;config.yml&quot;)

# Filter the hosts by 'west-region' assignment
west_region = nr.filter(region=&quot;west-region&quot;)


def example_netconf_get_capabilities(task):
    &quot;&quot;&quot;Test get capabilities.&quot;&quot;&quot;
    task.run(netconf_capabilities)


def main():
    &quot;&quot;&quot;Execute Nornir Script.&quot;&quot;&quot;
    print_result(west_region.run(task=example_netconf_get_capabilities))


if __name__ == &quot;__main__&quot;:
    main()
</code></pre>


</details>

<details><summary>Task: Edit-Config with Global Lock</summary>



<pre><code class="language-python">&quot;&quot;&quot;Nornir NETCONF Example Task: 'edit-config', 'netconf_lock'.&quot;&quot;&quot;
from nornir import InitNornir
from nornir_utils.plugins.functions import print_result
from nornir_netconf.plugins.tasks import netconf_edit_config, netconf_lock, netconf_commit


__author__ = &quot;Hugo Tinoco&quot;
__email__ = &quot;hugotinoco@icloud.com&quot;

nr = InitNornir(&quot;config.yml&quot;)

# Filter the hosts by 'west-region' assignment
west_region = nr.filter(region=&quot;west-region&quot;)


def example_global_lock(task):
    &quot;&quot;&quot;Test global lock operation of 'candidate' datastore.&quot;&quot;&quot;
    lock = task.run(netconf_lock, datastore=&quot;candidate&quot;, operation=&quot;lock&quot;)
    # Retrieve the Manager(agent) from lock operation and store for further
    # operations.
    task.host[&quot;manager&quot;] = lock.result[&quot;manager&quot;]


def example_edit_config(task):
    &quot;&quot;&quot;Test edit-config with global lock using manager agent.&quot;&quot;&quot;

    config_payload = &quot;&quot;&quot;
    &lt;config&gt;
        &lt;configure xmlns=&quot;urn:nokia.com:sros:ns:yang:sr:conf&quot;&gt;
            &lt;router&gt;
                &lt;router-name&gt;Base&lt;/router-name&gt;
                &lt;interface&gt;
                    &lt;interface-name&gt;L3-OAM-eNodeB069420-X1&lt;/interface-name&gt;
                    &lt;admin-state&gt;disable&lt;/admin-state&gt;
                    &lt;ingress-stats&gt;false&lt;/ingress-stats&gt;
                &lt;/interface&gt;
            &lt;/router&gt;
        &lt;/configure&gt;
    &lt;/config&gt;
    &quot;&quot;&quot;

    result = task.run(
        netconf_edit_config, config=config_payload, target=&quot;candidate&quot;, manager=task.host[&quot;manager&quot;], xmldict=True
    )

    # Access the RPC response object directly.
    # Or you can check the 'ok' attr from an rpc response as well, if it exists.
    if &quot;ok&quot; in result.result[&quot;rpc&quot;].data_xml:
        task.run(netconf_commit, manager=task.host[&quot;manager&quot;], xmldict=True)

    # Check OK key exists, as we passed in 'xmldict=True'
    print(result.result[&quot;xml_dict&quot;].keys())

def example_unlock(task):
    &quot;&quot;&quot;Unlock candidate datastore.&quot;&quot;&quot;
    task.run(netconf_lock, datastore=&quot;candidate&quot;, operation=&quot;unlock&quot;, manager=task.host[&quot;manager&quot;])


def main():
    &quot;&quot;&quot;Execute Nornir Script.&quot;&quot;&quot;
    print_result(west_region.run(task=example_global_lock))
    print_result(west_region.run(task=example_edit_config))
    print_result(west_region.run(task=example_unlock))


if __name__ == &quot;__main__&quot;:
    main()

</code></pre>


</details>

<h3 id="additional-documentation">Additional Documentation</h3>
<ul>
<li><a href="https://ncclient.readthedocs.io/en/latest/">NCClient</a></li>
<li><a href="https://www.sysrepo.org/">Sysrepo</a></li>
</ul>
<h2 id="contributions">Contributions</h2>
<hr />
<p>No line of code shall go un tested! Any contribution will need to be accounted by the coverage report and satisfy all linting.</p>
<p>Linters:</p>
<ul>
<li>Fake8</li>
<li>Black</li>
<li>Yamllint</li>
<li>Pylint</li>
<li>Pydocstyle</li>
<li>Bandit</li>
<li>MyPy</li>
</ul>
<h3 id="testing">Testing</h3>
<p>To test within a local docker environment</p>
<pre><code class="language-bash">git clone https://github.com/h4ndzdatm0ld/nornir_netconf
</code></pre>
<pre><code class="language-bash">docker-compose build &amp;&amp; docker-compose run test
</code></pre>
<p>To test locally with pytest</p>
<pre><code class="language-bash">docker-compose up netconf1
</code></pre>
<pre><code class="language-bash">poetry install &amp;&amp; poetry shell
</code></pre>
<pre><code class="language-bash">pytest --cov=nornir_netconf --color=yes --disable-pytest-warnings -vvv
</code></pre>
<h3 id="integration-tests">Integration Tests</h3>
<p>Devices with full integration tests (Eve-NG)</p>
<ul>
<li>Nokia SROS - TiMOS-C -20.5.R2</li>
<li>Cisco IOSxR - 6.3.1</li>
</ul>
<p>Devices testing against Always-ON Sandboxes (Cisco DevNet)</p>
<ul>
<li>ios-xe - Cisco IOS XE Software, Version 17.03.01a</li>
<li>ios-xr - ( Pending )</li>
</ul>
<p>These tests are ran locally against an EVE-NG environment. At the moment, there is no solution to run these integration tests within the Github Actions CI.</p>
<h3 id="sysrepo-netopeer2">Sysrepo: netopeer2</h3>
<p>Majority of integration tests are ran against a docker instance of <a href="https://hub.docker.com/r/sysrepo/sysrepo-netopeer2">netopeer2</a></p>
<p>From the <a href="https://www.sysrepo.org/">Sysrepo</a> website:</p>
<p>"Netopeer2 and Sysrepo provide a fully open source and standards compliant implementation of a NETCONF server and YANG configuration data stores."</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/h4ndzdatm0ld/nornir_netconf/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.2.2
Build Date UTC : 2021-09-17 21:15:23.407383+00:00
-->
